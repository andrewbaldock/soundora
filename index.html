<!DOCTYPE html>
<html>
<head>
    <title>Soundora</title>
    <!-- github.com/andrewbaldock/soundora -->
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0" name="viewport">
    <meta content="Soundora is a Pandora clone built using the SoundCloud API" name="description">
    <meta content="SoundCloud Radio" name="keywords">
    <link href="http://andrewbaldock.com/soundora" rel="canonical">
    <link href="/img/sitepreview.png" rel="image_src" type="text/css">
    <link href="css/style.css" rel="stylesheet" type="text/css">
    <link href="../css/longshadow.css" rel="stylesheet" type="text/css">
    <script data-main="js/app/startup" src="js/lib/require.js"></script>
</head>
<body>
    <div id="tippytop">
    		<div id="logged-out">
        	<a href="#" id="signin-link">Sign In</a> 
        </div>
        
        <div id="logged-in">
        	<div id="user-wrapper">
						<div id="user">
						
						</div>	
						<div id="user-dropdown">
							<span id="username"></span>
							<a href="#" id="logout" onclick="disconnectUser();">Logout <em class="icon-logout"></em></a>
						</div>
        	</div>
        </div>
    </div>

    <header>
        <div id="signin-panel">
        		<!-- googleplus-->
            <span id="signinButton">
							<span
								class="g-signin"
								data-callback="googCallback"
								data-width="wide" 
								data-theme="light"
								data-clientid="881156022619.apps.googleusercontent.com"
								data-cookiepolicy="http://andrewbaldock.com"
								data-requestvisibleactions="http://schemas.google.com/AddActivity"
								data-scope="https://www.googleapis.com/auth/plus.login">
							</span>
						</span>
        </div>

       
    </header>

    <div id="main">
        <h1>Soundora</h1>
        <p id="subtitle">soundcloud radio</p>
        <div id="spinner"></div>
        <div id="thequery">
            <form action="" id="search" name="search" onsubmit=
            "return formHandler();">
                <input class="field" id="query" type="text" value= "" placeholder="song title, artist or genre">
                <button type="submit">
                	<em class="icon-search"></em>
                </button>
            </form>
        </div>
    </div>

    <div id="player-wrapper">
        <div id="player">
            <iframe frameborder="no" height="120" id="widget" name="widget"
            scrolling="no" seamless="seamless" src="" width="100%"></iframe>
        </div>
    </div>

    <div id="results"></div>

    <div id="pad">&nbsp;</div>

    <footer>
        <div id="credits">
            <a href="http://andrewbaldock.com">Andrew Baldock</a>
            Â© <span id="yr">2013</span>
        </div>
    </footer>
    
  	<script>

  			// handle forms
  			function formHandler(e){
					return false;
				}
  	
        //copyright date
				var gudYr = new Date().getFullYear();
				document.getElementById('yr').innerHTML = gudYr;
				
				
				/* GOOGLE SIGNIN
				*/
				var goog={};
				var clientId = '881156022619';
				var apiKey = 'AIzaSyD4ZGwVyyh2RN40PFeifk6QecZvk3O-BGk';
				var scopes = 'https://www.googleapis.com/auth/plus.me';

				// Use a button to handle authentication the first time.
				function handleClientLoad() {
					gapi.client.setApiKey(apiKey);
					window.setTimeout(checkAuth,1);
				}

				function checkAuth() {
					//gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: true}, handleAuthResult);
				}

				function handleAuthResult(authResult) {
					if (authResult && !authResult.error) {
						// Load the API and make an API call.  Display the results on the screen.

						gapi.client.load('plus', 'v1', function() {
							var request = gapi.client.plus.people.get({
								'userId': 'me'
							});
							request.execute(function(resp) {
								goog.user = resp;
								if (typeof resp.image.url != 'undefined') {
									var theoutput = '<div id="theuser"><img class="userimg" src="' + resp.image.url + '"></div>';
								} else {
									var theoutput = '<div id="theuser"><em class="userimg" class="icon-search"></em></div>';
								}
								if( $('#theuser').length == 0) {
									$('#username').html(resp.displayName);
									$('#user').html(theoutput)
								}
							});
						});
					
					} 
				}

			
				
				// asyc g+ signin init
				(function() {
					 var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
					 po.src = 'https://apis.google.com/js/client:plusone.js';
					 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
				})();
				
				// g+ callback
				function googCallback(authResult) {
					if (authResult['access_token']) {
						// Successfully authorized
						// Hide the sign-in button now that the user is authorized, for example:
						//document.getElementById('signinButton').setAttribute('style', 'display: none');
						console.log('google authenticated');
						$('#logged-out').hide();
						$('#signin-panel').hide();
						$('#logged-in').show();
						goog.token = authResult.access_token;
						gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: true}, handleAuthResult);
				
					} else if (authResult['error']) {
						
						// There was an error.
						// Possible error codes:
						//   "access_denied" - User denied access to your app
						//   "immediate_failed" - Could not automatically log in the user
						// console.log('There was an error: ' + authResult['error']);
						$('#logged-in').hide();
						$('#logged-out').show();
					}
				}  
				
				function disconnectUser() {
					var revokeUrl = 'https://accounts.google.com/o/oauth2/revoke?token=' + goog.token;
					$.ajax({
						type: 'GET',
						url: revokeUrl,
						async: false,
						contentType: "application/json",
						dataType: 'jsonp',
						success: function(nullResponse) {
							// Do something now that user is disconnected
							// The response is always undefined.
								$('#logged-in').hide();
								$('#signin-panel').hide();
								$('#logged-out').show();
						},
						error: function(e) {
							// Handle the error
							// console.log(e);
							// You could point users to manually disconnect if unsuccessful
							// https://plus.google.com/apps
							
						}
					});
				} 
				
				
    </script>
    
    <script type="text/javascript">   
      
    </script>
    <script src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>
</body>
</html>